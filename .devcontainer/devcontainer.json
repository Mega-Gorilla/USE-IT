// For format details, see https://aka.ms/devcontainer.json. For config options, see the
// README at: https://github.com/devcontainers/templates/tree/main/src/docker-existing-dockerfile
{
	"name": "Browser-Use Development",

	// Option A: Use docker-compose for shm-size support
	"dockerComposeFile": "docker-compose.yml",
	"service": "browser-use",
	"workspaceFolder": "/workspaces/browser-use",

	// Override entrypoint for development (disable browser-use CLI auto-start)
	"overrideCommand": true,

	// Option B: Use Dockerfile directly (comment out Option A above and uncomment below)
	// "build": {
	// 	"context": "..",
	// 	"dockerfile": "../Dockerfile"
	// },
	// "runArgs": ["--shm-size=2g"],
	"features": {
		"ghcr.io/devcontainers/features/git:1": {},
		"ghcr.io/jsburckhardt/devcontainer-features/codex:1": {}
	},

	// User configuration
	"remoteUser": "user",
	"containerUser": "user",

	// Environment variables to fix /data directory permission issues
	"containerEnv": {
		// Use home directory instead of /data to avoid permission issues
		"BROWSER_USE_CONFIG_DIR": "/home/user/.config/browser-use",
		// Keep telemetry as configured
		"ANONYMIZED_TELEMETRY": "${localEnv:ANONYMIZED_TELEMETRY:true}"
	},

	// Configure tool-specific properties.
	"customizations": {
		"vscode": {
			"extensions": [
				// AI
				"anthropic.claude-code",
				"openai.chatgpt",

				// Git
				"eamodio.gitlens",
				"mhutchie.git-graph",

				// Python
				"ms-python.python",
				"ms-python.vscode-pylance",
				"charliermarsh.ruff",

				// General development
				"editorconfig.editorconfig",
				"streetsidesoftware.code-spell-checker",
				"usernamehw.errorlens",
				"christian-kohler.path-intellisense"
			]
		}
	},

	// Forward ports for browser debugging and development
	"forwardPorts": [9222, 9242],

	// Post-create command to set up the environment
	"postCreateCommand": "sudo mkdir -p /home/user/.config/browser-use && sudo chown -R user:user /home/user/.config/browser-use && echo 'âœ… Browser-Use development environment ready!'",

	// Mounts to persist browser data between container rebuilds
	"mounts": [
		// Persist browser profiles and extensions
		"source=${localWorkspaceFolderBasename}-browser-data,target=/home/user/.config/browser-use,type=volume"
	],

	// Additional settings
	"postStartCommand": "echo 'Browser-Use config directory: $BROWSER_USE_CONFIG_DIR'"
}
